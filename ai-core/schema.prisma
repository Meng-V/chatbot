// Prisma schema for Python client
// ⚠️  AUTO-GENERATED: Models are synced from /prisma/schema.prisma
// ⚠️  Do NOT edit models here. Edit /prisma/schema.prisma and run:
//     ./local-auto-start.sh --sync-prisma
generator client {
  provider             = "prisma-client-py"
  interface            = "asyncio"
  recursive_type_depth = 5
}

// NOTE: Python Prisma client (v5.17) still requires url property
// Main schema uses Prisma v7 syntax, but Python client hasn't upgraded yet
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Message {
  id              String       @id @default(uuid())
  type            String       @db.VarChar(10)
  content         String
  timestamp       DateTime     @default(now())
  conversationId  String
  isPositiveRated Boolean?
  conversation    Conversation @relation(fields: [conversationId], references: [id])
}

model Conversation {
  id                   String                @id @default(uuid())
  toolUsed             String[]              @default([])
  conversationFeedback ConversationFeedback?
  messageList          Message[]
  tokenUsages          ModelTokenUsage[]
  toolExecutions       ToolExecution[]
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
}

model ModelTokenUsage {
  id               String       @id @default(uuid())
  llmModelName     String
  completionTokens Int
  promptTokens     Int
  totalTokens      Int
  conversationId   String
  conversation     Conversation @relation(fields: [conversationId], references: [id])
  createdAt        DateTime     @default(now())
}

model ToolExecution {
  id              String       @id @default(uuid())
  conversationId  String
  agentName       String
  toolName        String
  parameters      String       @default("{}")
  success         Boolean
  executionTime   Int          @default(0)
  timestamp       DateTime     @default(now())
  conversation    Conversation @relation(fields: [conversationId], references: [id])
  
  @@index([conversationId])
  @@index([agentName])
  @@index([toolName])
}

model ConversationFeedback {
  id             String       @id @default(uuid())
  rating         Int
  userComment    String
  conversationId String       @unique
  conversation   Conversation @relation(fields: [conversationId], references: [id])
}

// MuGuide Subject Mapping Models
model Subject {
  id          String             @id @default(uuid())
  name        String             @unique
  regional    Boolean            @default(false)
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  libGuides   SubjectLibGuide[]
  regCodes    SubjectRegCode[]
  majorCodes  SubjectMajorCode[]
  deptCodes   SubjectDeptCode[]

  @@index([name])
}

model SubjectLibGuide {
  id        String  @id @default(uuid())
  subjectId String
  libGuide  String
  subject   Subject @relation(fields: [subjectId], references: [id], onDelete: Cascade)

  @@unique([subjectId, libGuide])
  @@index([libGuide])
}

model SubjectRegCode {
  id        String  @id @default(uuid())
  subjectId String
  regCode   String
  regName   String
  subject   Subject @relation(fields: [subjectId], references: [id], onDelete: Cascade)

  @@unique([subjectId, regCode])
  @@index([regCode])
}

model SubjectMajorCode {
  id         String  @id @default(uuid())
  subjectId  String
  majorCode  String
  majorName  String
  subject    Subject @relation(fields: [subjectId], references: [id], onDelete: Cascade)

  @@unique([subjectId, majorCode])
  @@index([majorCode])
  @@index([majorName])
}

model SubjectDeptCode {
  id        String  @id @default(uuid())
  subjectId String
  deptCode  String
  deptName  String
  subject   Subject @relation(fields: [subjectId], references: [id], onDelete: Cascade)

  @@unique([subjectId, deptCode])
  @@index([deptCode])
  @@index([deptName])
}

// Library Location Hierarchy Models
model Campus {
  id          String    @id @default(uuid())
  name        String    @unique // "Oxford", "Hamilton", "Middletown"
  displayName String    // "Oxford Campus", "Hamilton Campus"
  isMain      Boolean   @default(false) // True for Oxford (flagship)
  libraries   Library[]
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([name])
}

model Library {
  id              String         @id @default(uuid())
  campusId        String
  name            String         // "King Library", "Rentschler Library"
  displayName     String         // "Edgar W. King Library"
  shortName       String?        // "King", "Art", "Rentschler"
  libcalBuildingId String        @unique // LibCal building ID for RESERVATIONS API (e.g., "2047" for King - from Image 2)
  libcalLocationId String?       // LibCal location ID for HOURS API (e.g., "8113" for King - from Image 1)
  phone           String?        // Contact phone number (e.g., "513-529-4141")
  address         String?        // Physical address (e.g., "151 S. Campus Ave, Oxford, OH 45056")
  isMain          Boolean        @default(false) // True for main library on each campus
  spaces          LibrarySpace[]
  campus          Campus         @relation(fields: [campusId], references: [id], onDelete: Cascade)
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  @@index([name])
  @@index([shortName])
  @@index([libcalBuildingId])
  @@index([libcalLocationId])
}

model LibrarySpace {
  id              String   @id @default(uuid())
  libraryId       String
  name            String   // "Maker Space", "Special Collections & University Archives"
  displayName     String   // Full display name
  shortName       String?  // "Makerspace", "Special Collections"
  libcalLocationId String  @unique // LibCal location ID for hours API (e.g., "11904" for Makerspace, "8424" for Special Collections)
  libcalBuildingId String? @unique // LibCal building ID for reservations (e.g., "8269" for Makerspace, "10395" for Special Collections)
  spaceType       String   @default("service") // "service", "collection", "study_area"
  library         Library  @relation(fields: [libraryId], references: [id], onDelete: Cascade)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([name])
  @@index([shortName])
  @@index([libcalLocationId])
  @@index([libcalBuildingId])
}
