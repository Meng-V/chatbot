# ================================================================================================
# MIAMI UNIVERSITY LIBRARIES - SMART CHATBOT
# Environment Configuration Template - Version 3.1.0
# ================================================================================================
# 
# INSTRUCTIONS:
# 1. Copy this file to .env in the root directory: cp .env.example .env
# 2. Fill in your actual values (replace placeholders)
# 3. For local development, you can create .env.local to override specific values
# 4. NEVER commit .env or .env.local to version control
#
# VERSION 3.1 CHANGES:
# - Added RAG-based classification using Weaviate for intent detection
# - Smart clarification system with interactive button choices
# - Database-driven library addresses (no longer uses web search)
# - Enhanced hybrid routing for faster responses
# - Python 3.13 required for Prisma compatibility
#
# ================================================================================================

# ================================= LLM (OpenAI) ==========================================
OPENAI_ORGANIZATION_ID=your_org_id_here
OPENAI_API_KEY=sk-your_api_key_here
OPENAI_MODEL=o4-mini
# Note: o4-mini is optimized for speed. Models starting with "o" don't support temperature parameter.
# Alternative models: gpt-4o, gpt-4-turbo, gpt-4, gpt-3.5-turbo

# ================================= Database & Vector DB ==========================================
# PostgreSQL Database (Production)
DATABASE_URL=postgresql://username:password@host:5432/database?sslmode=require

# Weaviate Vector Database (Local Docker)
# Local: host ports 8081/50052 map to container 8080/50051 (avoids conflicts)
# Production: use 8080/50051 directly. No API key needed (anonymous auth).
WEAVIATE_ENABLED=true
WEAVIATE_HOST=127.0.0.1
WEAVIATE_SCHEME=http
WEAVIATE_HTTP_PORT=8081
WEAVIATE_GRPC_PORT=50052

# Website Evidence RAG Collection (Jekyll-derived website content)
WEBSITE_EVIDENCE_COLLECTION=

# ================================= Google Custom Search Engine ==========================================
GOOGLE_API_KEY=your_google_api_key_here
GOOGLE_LIBRARY_SEARCH_CSE_ID=your_cse_id_here

DISABLE_GOOGLE_SITE_SEARCH=0
GOOGLE_SEARCH_DAILY_LIMIT=10000

# 7 days (604800 seconds)
GOOGLE_SEARCH_CACHE_TTL_SECONDS=604800
# ================================= SpringShare APIs: LibCal, LibGuides, LibAnswers ==========

# LibCal API (Hours & Room Reservations)
LIBCAL_CLIENT_ID=your_client_id
LIBCAL_CLIENT_SECRET=your_client_secret
LIBCAL_TOKEN_URL=https://yourschool.libcal.com/1.1/oauth/token
LIBCAL_API_BASE_URL=https://yourschool.libcal.com/1.1

# LibCal Location IDs (Hours API) - customize for your institution
LIBCAL_KING_LOCATION_ID=9999
LIBCAL_ART_LOCATION_ID=9999
LIBCAL_HAMILTON_LOCATION_ID=9999
LIBCAL_MIDDLETOWN_LOCATION_ID=9999

# LibCal Building IDs (Reservations API)
LIBCAL_KING_BUILDING_ID=9999
LIBCAL_ART_BUILDING_ID=9999
LIBCAL_HAMILTON_BUILDING_ID=9999
LIBCAL_MIDDLETOWN_BUILDING_ID=9999

# Ask Us Chat Service ID (for librarian availability)
LIBCAL_ASKUS_ID=9999

# LibGuides API
LIBGUIDES_SITE_ID=9999
LIBGUIDES_API_KEY=your_api_key
LIBGUIDES_API_URL=https://lgapi-us.libapps.com/1.1

# LibAnswers API (Chat Handoff)
LIBANSWERS_IID=9999
LIBANSWERS_CLIENT_ID=your_client_id
LIBANSWERS_CLIENT_SECRET=your_client_secret
LIBANSWERS_TOKEN_URL=https://yourschool.libanswers.com/1.1/oauth/token
LIBANSWERS_API_BASE_URL=https://yourschool.libanswers.com/1.1

# ================================= MyGuide (Subject-to-Librarian Mapping) ======================================
# MyGuide API for subject-to-librarian routing (Miami University specific)
# This powers the subject librarian finder feature
MYGUIDE_API_URL=https://myguide.yourschool.edu/api/subjects
MYGUIDE_ID=your_myguide_id_here
MYGUIDE_API_KEY=your_myguide_api_key_here

# ================================= System Configuration ==========================================

# Environment Mode
NODE_ENV=development

# Development URLs (for local development)
# FRONTEND_URL=http://localhost:5173

# Production URLs (for deployment)
FRONTEND_URL=https://library.yourlib.edu

# Port Configuration
BACKEND_PORT=8000
FRONTEND_PORT=5173

# Base Path for Socket.IO
SOCKET_PATH=/smartchatbot

# ================================= Frontend (Vite/React) Configuration ===========================

# LibAnswers Chat Widget
VITE_LIBANSWERS_WIDGET_URL=https://libanswers.yourlib.edu/chat/widget/YOUR_WIDGET_ID

# Frontend Build Configuration
VITE_BACKEND_URL=https://library.yourlib.edu
VITE_BACKEND_PORT=8000
VITE_FRONTEND_PORT=5173
VITE_FRONTEND_DOMAIN=library.yourlib.edu
VITE_BASE_PATH=/smartchatbot
VITE_SOCKET_DOMAIN=

# ================================= Local Development Overrides ===================================
# For local development, create a .env.local file with these values:
#
# DATABASE_URL=postgresql://username:password@localhost:5432/chatbot_dev
# FRONTEND_URL=http://localhost:5173
# VITE_BACKEND_URL=http://localhost:8000
# VITE_SOCKET_DOMAIN=http://localhost:8000
# NODE_ENV=development
#
# ================================= Advanced Features (Optional) ===================================

# RAG Classification Thresholds (adjust sensitivity)
# Lower values = more frequent clarification requests
# Higher values = fewer clarification requests
RAG_MARGIN_THRESHOLD=0.15
RAG_SCORE_DIFF_THRESHOLD=0.3

# CORS Configuration (comma-separated list)
CORS_ORIGINS=["http://localhost:5173","https://your-domain.edu"]

# Logging Level (DEBUG, INFO, WARNING, ERROR)
LOG_LEVEL=INFO

# ================================================================================================
# VERSION 3.1.0 - December 22, 2025
# 
# NEW IN VERSION 3.1:
# - RAG-based classification with Weaviate (WEAVIATE_URL, WEAVIATE_COLLECTION)
# - Clarification thresholds (RAG_MARGIN_THRESHOLD, RAG_SCORE_DIFF_THRESHOLD)
# - Enhanced Socket.IO events for clarification choices
# 
# REMOVED VARIABLES (no longer needed):
# - PRIMO_SCOPE, PRIMO_API_KEY, PRIMO_SEARCH_URL, PRIMO_VID (catalog search archived)
# - WEAVIATE_ENABLED, WEAVIATE_SCHEME (simplified configuration)
# - OXFORD_KING_LIBRARY, etc. (replaced with LIBCAL_*_LOCATION_ID and LIBCAL_*_BUILDING_ID)
#
# For more information, see /docs/07-ENVIRONMENT-VARIABLES.md
# ================================================================================================
